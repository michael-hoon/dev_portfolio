---
import '../styles/index.css';

import ProfilePicture from '../assets/pfp.jpg';

import Card from '../components/Card.astro';
import Layout from '../layouts/Layout.astro';
import ImageGlow from '../components/ImageGlow.astro';
import Icon from '../components/Icon.astro';
import { getCollection } from 'astro:content';
import { getEntry } from 'astro:content';
import { render } from 'astro:content';
import { name, openGraph } from 'spectre:globals';

const [posts, projects, about, workExperience, quickInfo, socials] = await Promise.all([
  getCollection('posts', (post) => post.data.draft !== true),
	getCollection('projects'),
	getEntry('other', 'about'),
	getCollection('workExperience'),
	getCollection('quickInfo'),
	getCollection('socials')
]);

// biome-ignore lint/style/noNonNullAssertion: Should always be defined.
const { Content: About } = await render(about!);
---

<Layout
	title={openGraph.home.title || name}
	description={openGraph.home.description}
	pagefindIgnore
>
	<div class="layout-grid-left" slot="left">
		<Card class="flex-col-card">
			<ImageGlow quality={100} width={320} height={320} src={ProfilePicture} alt="Michael Profile Picture" loading='eager' />
			<h2>{name}</h2>
			<ul class="overview-list">
				{quickInfo.map((info) => (
					<li>
						{info.data.link ? (
							<a href={info.data.link} class='quick-info-item quick-info-link' target="_blank" rel="noopener noreferrer">
								<Icon type={info.data.icon.type} name={info.data.icon.name as any} width={24} height={24} class='glow-icon' />
								<span>{info.data.text}</span>
							</a>
						) : (
							<div class='quick-info-item'>
								<Icon type={info.data.icon.type} name={info.data.icon.name as any} width={24} height={24} class='glow-icon' />
								<span>{info.data.text}</span>
							</div>
						)}
					</li>
				))}
			</ul>
		</Card>
		<Card>
			<h3 class="no-mt">Socials</h3>
			<ul class="overview-list">
				{socials.map((item) => (
					<li>
						<a href={item.data.link} class="socials-link">
							<Icon type={item.data.icon.type} name={item.data.icon.name as any} width={24} height={24} class='glow-icon' />
							<span>{item.data.text}</span>
						</a>
					</li>
				))}
			</ul>
		</Card>
	</div>
	<div class="layout-grid-right" slot="right">
		<Card>
			<div class="header-container">
				<Icon type='lucide' name="user" width={24} height={24} class='glow-icon' />
				<h2>About me</h2>
			</div>
			<div class="prose">
				<About />
			</div>
		</Card>
		<Card>
			<div class="header-container">
				<Icon type='lucide' name="folder-git" width={24} height={24} class='glow-icon' />
				<h2>Latest Projects</h2>
			</div>
			<div class="content-container">
				{projects.sort((a, b) => b.data.date.getTime() - a.data.date.getTime()).slice(0, 2).map((project) => (
					<a href={`/projects/${project.id}`} class="post-container">
						<div class="post-header">
							<h3>{project.data.title}</h3>
							<span class="post-date">{project.data.date.toLocaleDateString()}</span>
						</div>
						<span>{project.data.description}</span>
					</a>
				))}
			</div>
		</Card>
		<Card>
			<div class="header-container">
				<Icon type='lucide' name="briefcase-business" width={24} height={24} class='glow-icon' />
				<h2>Work Experience</h2>
			</div>
			<div class="work-experience-container">
				{workExperience.reverse().map((entry) => (
					<div class="work-experience-entry">
						<span class="work-experience-duration">{entry.data.duration}</span>
						<h3 class="work-experience-company">{entry.data.company}</h3>
						<span class="work-experience-role">{entry.data.title}</span>
						<p class="work-experience-desc">{entry.data.description}</p>
					</div>
				))}
			</div>
		</Card>
		<Card>
	      <div class="header-container">
	        <Icon type='lucide' name="camera" width={24} height={24} class='glow-icon' />
	        <h2>Photography</h2>
	      </div>
	      <a href="/photography" class="gallery-strip" aria-label="Open photography gallery">
	        <div class="gallery-strip-row">
	          <img src="/photos/thumb-1.jpg" alt="Thumbnail 1" loading="lazy" />
	          <img src="/photos/thumb-2.jpg" alt="Thumbnail 2" loading="lazy" />
	          <img src="/photos/thumb-3.jpg" alt="Thumbnail 3" loading="lazy" />
	          <img src="/photos/thumb-4.jpg" alt="Thumbnail 4" loading="lazy" />
	        </div>
	      </a>
	    </Card>
	</div>
</Layout>
<style>
	.quick-info-item {
		display: flex;
		align-items: center;
		gap: 1rem;
		text-decoration: none;
		color: inherit;
	}

	/* Only underline links, not plain items */
	.quick-info-link:hover span {
		text-decoration: underline;
	}

	/* Match socials hover color for resume link */
	.quick-info-link {
		color: white;
	}

	.quick-info-link:hover,
	.quick-info-link:focus-visible {
		color: var(--primary-lightest);
	}

  .gallery-strip {
    display: block;
    text-decoration: none;
    color: inherit;
  }

  .gallery-strip-row {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: .5rem;
  }

  .gallery-strip-row img {
    width: 100%;
    aspect-ratio: 4 / 3;
    object-fit: cover;
    border: 1px solid #353535;
    background: #111;
  }
</style>
